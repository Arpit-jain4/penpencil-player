/*! @name videojs-setting-menu @version 1.0.0 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsSettingMenu=t(e.videojs)}(this,function(e){"use strict";function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}e=e&&e.hasOwnProperty("default")?e.default:e;var s="showMainMenu",n="goToMainMenu",i="toggleRatioMenu",a="toggleSpeedMenu",l="toggleQualityMenu",o="changePlaybackRate",c="changePlayerQuality",r="changeAspectRatio",u=e.getComponent("Button"),p={},d=function(n){function i(t,s){var i;return(i=n.call(this,t,s)||this).options=e.mergeOptions(p,s),i}t(i,n);var a=i.prototype;return a.buildCSSClass=function(){return"vjs-setting-menu-button vjs-icon-cog "+n.prototype.buildCSSClass.call(this)},a.handleClick=function(e){this.player_.trigger(s,{}),e.target.classList.contains("vjs-setting-button-anim")?e.target.classList.remove("vjs-setting-button-anim"):e.target.classList.add("vjs-setting-button-anim")},i}(u);d.defaultState={},d.VERSION="1.0.0",e.registerComponent("settingButton",d);var v=e.getComponent("ClickableComponent"),m={},g=function(s){function n(t,n){var i;return(i=s.call(this,t,n)||this).options=e.mergeOptions(m,n),i}t(n,s);var i=n.prototype;return i.createEl=function(){return e.dom.createEl("div",{className:"vjs-setting-item",innerHTML:this.options_.innerHTML})},i.handleClick=function(e){switch(this.player().trigger(this.options_.event,this.options_.value),this.options_.event){case o:this.playbackRateDomMod(e,this.options_.value);break;case c:this.qualityDomMod(e,this.options_.value);break;case r:this.aspectDomMod(e,this.options_.value)}},i.playbackRateDomMod=function(e,t){document.getElementsByClassName("vjs-setting-speed")[0].innerHTML=1===t?"Normal":t+"x",document.getElementsByClassName("vjs-speed vjs-icon-circle-inner-circle")[0].classList.add("vjs-icon-circle-outline"),document.getElementsByClassName("vjs-speed vjs-icon-circle-inner-circle")[0].classList.remove("vjs-icon-circle-inner-circle"),e.target&&e.target.children.length>1?(e.target.children[1].classList.add("vjs-icon-circle-inner-circle"),e.target.children[1].classList.remove("vjs-icon-circle-outline")):(e.currentTarget.children[1].classList.add("vjs-icon-circle-inner-circle"),e.currentTarget.children[1].classList.remove("vjs-icon-circle-outline"))},i.qualityDomMod=function(e,t){document.getElementsByClassName("vjs-setting-quality")[0].innerHTML="Auto"===t.label?"Auto":t.label+"p",document.getElementsByClassName("vjs-quality vjs-icon-circle-inner-circle")[0].classList.add("vjs-icon-circle-outline"),document.getElementsByClassName("vjs-quality vjs-icon-circle-inner-circle")[0].classList.remove("vjs-icon-circle-inner-circle"),e.target&&e.target.children.length>1?(e.target.children[1].classList.add("vjs-icon-circle-inner-circle"),e.target.children[1].classList.remove("vjs-icon-circle-outline")):(e.currentTarget.children[1].classList.add("vjs-icon-circle-inner-circle"),e.currentTarget.children[1].classList.remove("vjs-icon-circle-outline"))},i.aspectDomMod=function(e,t){document.getElementsByClassName("vjs-setting-ratio")[0].innerHTML=t,document.getElementsByClassName("vjs-ratio vjs-icon-circle-inner-circle")[0].classList.add("vjs-icon-circle-outline"),document.getElementsByClassName("vjs-ratio vjs-icon-circle-inner-circle")[0].classList.remove("vjs-icon-circle-inner-circle"),e.target&&e.target.children.length>1?(e.target.children[1].classList.add("vjs-icon-circle-inner-circle"),e.target.children[1].classList.remove("vjs-icon-circle-outline")):(e.currentTarget.children[1].classList.add("vjs-icon-circle-inner-circle"),e.currentTarget.children[1].classList.remove("vjs-icon-circle-outline"))},i.dispose=function(){s.prototype.dispose.call(this)},n}(v);g.defaultState={},g.VERSION="1.0.0",e.registerComponent("settingMenuSubItem",g);var h=e.getComponent("Menu"),y=e.getComponent("Component"),j={},f=function(s){function n(t,n){var i;(i=s.call(this,t,n)||this).options=e.mergeOptions(j,n);var a=i.options_.options||[];return i.update(a),i.el().classList.add("vjs-hidden"),i}t(n,s);var i=n.prototype;return i.createEl=function(){return e.dom.createEl("div",{className:"vjs-settings-menu-"+this.options_.name+" "})},i.update=function(e){var t=this.createMenu(e);this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=t,this.addChild(t)},i.createMenu=function(e){var t=new h(this.player(),{contentElType:"div"});if(e&&e.length)for(var s=0;s<e.length;s++){var n=new g(this.player(),e[s]);t.addChild(n)}return t},i.dispose=function(){s.prototype.dispose.call(this)},n}(y);f.defaultState={},f.VERSION="1.0.0",e.registerComponent("settingMenuItem",f);var C=e.getComponent("Menu"),L=e.getComponent("Component"),M={menu:["speed","quality"],speed:[],aspectRatio:["16:9","4:3"],sources:[],defaultQuality:"default"},b=function(u){function p(t,p){var d;return(d=u.call(this,t,p)||this).options=e.mergeOptions(M,p),d.el().classList.add("vjs-hidden"),t.on("ready",function(){console.log("ready"),d.getSpeedList(),d.getRatioList(),d.getQualityList()}),t.on("loadedmetadata",function(){console.log("loadedmetadata"),d.getSpeedList(),d.getRatioList(),d.getQualityList()}),t.on("userinactive",function(){var e=document.getElementsByClassName("vjs-setting-menu-main"),t=document.getElementsByClassName("vjs-settings-menu-home"),s=document.getElementsByClassName("vjs-settings-menu-speed"),n=document.getElementsByClassName("vjs-settings-menu-quality");d.eleClassAction(e,"vjs-hidden"),d.eleClassAction(t,"vjs-hidden"),d.eleClassAction(s,"vjs-hidden"),d.eleClassAction(n,"vjs-hidden")}),t.on(s,function(){var e=document.getElementsByClassName("vjs-setting-menu-main"),t=document.getElementsByClassName("vjs-settings-menu-home"),s=document.getElementsByClassName("vjs-settings-menu-speed"),n=document.getElementsByClassName("vjs-settings-menu-quality");t&&t[0]&&t[0].classList.contains("vjs-hidden")?(d.eleClassAction(e,"vjs-hidden","remove"),d.eleClassAction(t,"vjs-hidden","remove"),d.eleClassAction(s,"vjs-hidden"),d.eleClassAction(n,"vjs-hidden")):(d.eleClassAction(e,"vjs-hidden"),d.eleClassAction(t,"vjs-hidden"),d.eleClassAction(s,"vjs-hidden"),d.eleClassAction(n,"vjs-hidden"))}),t.on(a,function(){d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-home"),"vjs-hidden"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-speed"),"vjs-hidden","remove")}),t.on(i,function(){d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-home"),"vjs-hidden"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-ratio"),"vjs-hidden","remove")}),t.on(l,function(){d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-home"),"vjs-hidden"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-quality"),"vjs-hidden","remove")}),t.on(n,function(){d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-home"),"vjs-hidden","remove"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-speed"),"vjs-hidden"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-quality"),"vjs-hidden"),d.eleClassAction(document.getElementsByClassName("vjs-settings-menu-ratio"),"vjs-hidden")}),t.on(o,function(e,t){d.player().playbackRate(t||1)}),t.on(r,function(e,t){d.player().aspectRatio(t||"16:9")}),t.on(c,function(e,t){var s=d.player().tech().hls;if(t&&("application/x-mpegURL"===t.type||"application/dash+xml"===t.type)&&s){var n=s.playlists.master.playlists.filter(function(e){if(e&&e.resolvedUri===t.src)return e});n.length&&(s.playlists.media(n[0]),s.selectPlaylist=function(){return n[0]})}else{var i=d.player().paused(),a=d.player().currentTime();d.player().src(t),d.player().ready(function(){i||d.player().play(),d.player().currentTime(a)})}}),d}t(p,u);var d=p.prototype;return d.eleClassAction=function(e,t,s){void 0===s&&(s="add"),e&&e[0]&&e[0].classList&&t&&"add"===s?e[0].classList.add(t):e&&e[0]&&e[0].classList&&t&&"remove"===s&&e[0].classList.remove(t)},d.createEl=function(){return e.dom.createEl("div",{className:"vjs-setting-menu-main"})},d.update=function(){console.log("update");var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e)},d.createMenu=function(){var e=new C(this.player(),{contentElType:"div"}),t=[{name:"home",options:this.getHomeMenu()},{name:"speed",options:this.getSpeedMenu()},{name:"ratio",options:this.getRatioMenu()},{name:"quality",options:this.getQualityMenu()}];if(t&&t.length)for(var s=0;s<t.length;s++)e.addChild(new f(this.player_,t[s]));return e},d.getSpeedList=function(){var e=this.player().options_.playerOptions.playbackRates,t=this.player().playbackRate();this.options_.speed=e,this.options_.currentPlaybackSpeed=t},d.getRatioList=function(){this.options_.aspectRatio=["16:9","4:3"],this.options_.currentRatio="16:9"},d.getQualityList=function(){var e=this.player().currentSource(),t=this.player().tech().hls;if(e&&("application/x-mpegURL"===e.type||"application/dash+xml"===e.type)&&t){var s=t.playlists.master.playlists;if(this.options_.sources&&(e.src===s[0].resolvedUri||s[0].resolvedUri.includes(e.src)))return;this.options_.sources=s.map(function(t){return{src:!t.resolvedUri||5!==t.resolvedUri.split(":")[0].length&&4!==t.id.split(":")[0].length?t.resolvedUri.substr(2,t.resolvedUri.length-1):t.resolvedUri,label:t.attributes&&t.attributes.RESOLUTION&&t.attributes.RESOLUTION.height?t.attributes.RESOLUTION.height.toString():"240",type:e.type}}),this.options_.sources.push({src:e.src,label:"Auto",type:e.type}),this.options_.defaultQuality="Auto"}else if(e&&"video/mp4"===e.type){var n=this.player().currentSources(),i=[],a=this.options_.sources?this.options_.sources.filter(function(e){return e.src===n[0].src}):[];if(this.options_.sources&&e.src===n[0].src&&a.length&&a[0].src===e.src)return;n.forEach(function(e){e&&e.label&&i.push({src:e.src,label:e.label,type:e.type})}),this.options_.sources=i,this.options_.defaultQuality=e.label?e.label+"p":"Auto"}this.options_.sources&&this.options_.sources.length&&(this.options_.sources=this.options_.sources.sort(function(e,t){return parseInt(t.label,10)-parseInt(e.label,10)})),this.update()},d.playDefaultQuality=function(e,t,s){var n=[];(n="default"!==s&&t&&t.label!==s?e.filter(function(e){return e.label===s}):[e[e.length-1]]).length&&this.player().trigger(c,n[0])},d.getQualityMenu=function(){var e=this.player().currentSource(),t=(this.options_.sources||[]).map(function(t){return{name:"Auto"===t.label?"Auto":t.label+"p",value:t,isSelected:t.label===e.src||"Auto"===t.label,className:t.label===e.label||"Auto"===t.label?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline",event:c,innerHTML:'<span class="vjs-setting-title">'+("Auto"===t.label?"Auto":t.label+"p")+'</span>\n<span class="vjs-setting-icon vjs-quality '+(t.label===e.label||"Auto"===t.label?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline")+'"></span>'}});return t.splice(0,0,{name:"Quality",value:"Quality",isSelected:!1,className:"vjs-icon-play",event:n,innerHTML:'<span style="transform: rotate(180deg);" class="vjs-setting-icon vjs-icon-play"></span>\n                    <span class="vjs-setting-title">Quality</span>'}),t},d.getSpeedMenu=function(){var e=this.options_.speed,t=this.options_.currentPlaybackSpeed;if(e&&t){var s=e.map(function(e){return{name:e+"x",value:e,isSelected:e===t,className:e===t?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline",event:o,innerHTML:'<span class="vjs-setting-title">'+(1===e?"Normal":e+"x")+'</span>\n<span class="vjs-setting-icon vjs-speed '+(e===t?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline")+'"></span>'}});return s.splice(0,0,{name:"Speed",value:"Speed",isSelected:!1,className:"vjs-icon-play",event:n,innerHTML:'<span style="transform: rotate(180deg);" class="vjs-setting-icon vjs-icon-play"></span>\n                    <span class="vjs-setting-title">Speed</span>'}),s}},d.getRatioMenu=function(){var e=this.options_.aspectRatio,t=this.options_.currentRatio;if(e&&t){var s=e.map(function(e){return{name:e,value:e,isSelected:e===t,className:e===t?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline",event:r,innerHTML:'<span class="vjs-setting-title">'+(1===e?"Normal":e+"x")+'</span>\n<span class="vjs-setting-icon vjs-ratio '+(e===t?"vjs-icon-circle-inner-circle":"vjs-icon-circle-outline")+'"></span>'}});return s.splice(0,0,{name:"Ratio",value:"Ratio",isSelected:!1,className:"vjs-icon-play",event:n,innerHTML:'<span style="transform: rotate(180deg);" class="vjs-setting-icon vjs-icon-play"></span>\n                    <span class="vjs-setting-title">Ratio</span>'}),s}},d.getHomeMenu=function(){if(this.options.menu&&this.options.menu.length){var e=[],t=this.options.menu.map(function(e){return e.toString().toLowerCase()});return t.indexOf("share")>-1&&e.push({name:"Share",value:0,event:a,innerHTML:'<span class="vjs-setting-title">Share</span>\n<span class="vjs-setting-icon vjs-icon-share"></span>'}),t.indexOf("zoom")>-1&&e.push({name:"Zoom",class:"vjs-icon-spinner",value:0,event:a,innerHTML:'<span class="vjs-setting-title">Zoom</span>\n<span class="vjs-setting-icon vjs-icon-spinner"></span>'}),t.indexOf("related")>-1&&e.push({name:"Related",class:"vjs-icon-chapters",value:0,event:a,innerHTML:'<span class="vjs-setting-title text-left">Related</span>\n<span class="vjs-setting-icon vjs-icon-chapters"></span>'}),t.indexOf("aspect-ratio")>-1&&this.options_.aspectRatio&&this.options_.aspectRatio.length&&e.push({name:"Ratio",class:"",value:"16:9",event:i,innerHTML:'<span class="vjs-setting-title text-left">Ratio</span>\n<span class="vjs-setting-icon vjs-setting-ratio">16:9</span>'}),t.indexOf("speed")>-1&&this.options_.speed&&this.options_.speed.length&&e.push({name:"Speed",class:"",value:"Normal",event:a,innerHTML:'<span class="vjs-setting-title text-left">Speed</span>\n<span class="vjs-setting-icon vjs-setting-speed">Normal</span>'}),t.indexOf("quality")>-1&&this.options_.sources&&this.options_.sources.length&&e.push({name:"Quality",class:"",value:"250p",event:l,innerHTML:'<span class="vjs-setting-title text-left">Quality</span>\n<span class="vjs-setting-icon vjs-setting-quality">'+(this.options_.defaultQuality||"default")+"</span>"}),e}},d.dispose=function(){u.prototype.dispose.call(this)},p}(L);b.defaultState={},b.VERSION="1.0.0",e.registerComponent("settingMenuMain",b);var N=e.getPlugin("plugin"),S={},_=function(s){function n(t,n){var i;return(i=s.call(this,t)||this).options=e.mergeOptions(S,n),i.player.ready(function(){i.player.addClass("vjs-setting-menu"),i.player.controlBar.settingButton=i.player.controlBar.addChild("settingButton"),i.player.controlBar.el().insertBefore(i.player.controlBar.settingButton.el(),i.player.controlBar.fullscreenToggle.el()),i.player.controlBar.settingButton=i.player.controlBar.addChild("settingMenuMain")}),i}return t(n,s),n}(N);return _.defaultState={},_.VERSION="1.0.0",e.registerPlugin("settingMenu",_),_});
